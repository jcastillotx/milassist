[build]
builder = "NIXPACKS"

[deploy]
startCommand = "npm start"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "api"

[services.variables]
NODE_ENV = "production"
PORT = "3000"

[[services.ports]]
port = 3000

[[services.port_mappings]]
port = 3000
protocol = "TCP"

[env]
NODE_ENV = "production"
PORT = "3000"

# Database Configuration
DB_DIALECT = "postgres"
DB_HOST = "${{RAILWAY_PRIVATE_DOMAIN}}"
DB_PORT = "5432"
DB_NAME = "${{RAILWAY_DATABASE_NAME}}"
DB_USER = "${{RAILWAY_DATABASE_USERNAME}}"
DB_PASSWORD = "${{RAILWAY_DATABASE_PASSWORD}}"

# JWT Configuration
JWT_SECRET = "${{JWT_SECRET}}"
JWT_EXPIRATION = "24h"

# CORS Configuration
ALLOWED_ORIGINS = "${{FRONTEND_URL}}"
FRONTEND_URL = "${{RAILWAY_PUBLIC_DOMAIN}}"
APP_URL = "${{RAILWAY_PUBLIC_DOMAIN}}"

# Google Flights Configuration
GOOGLE_FLIGHTS_SCRAPER_TYPE = "${{GOOGLE_FLIGHTS_SCRAPER_TYPE}}"
OXYLABS_USERNAME = "${{OXYLABS_USERNAME}}"
OXYLABS_PASSWORD = "${{OXYLABS_PASSWORD}}"

# Twilio Configuration
TWILIO_ACCOUNT_SID = "${{TWILIO_ACCOUNT_SID}}"
TWILIO_AUTH_TOKEN = "${{TWILIO_AUTH_TOKEN}}"
TWILIO_PHONE_NUMBER = "${{TWILIO_PHONE_NUMBER}}"

# Email Configuration (if needed)
EMAIL_SERVICE = "${{EMAIL_SERVICE}}"
EMAIL_USER = "${{EMAIL_USER}}"
EMAIL_PASS = "${{EMAIL_PASS}}"

# OAuth Configuration (if needed)
GOOGLE_CLIENT_ID = "${{GOOGLE_CLIENT_ID}}"
GOOGLE_CLIENT_SECRET = "${{GOOGLE_CLIENT_SECRET}}"
MICROSOFT_CLIENT_ID = "${{MICROSOFT_CLIENT_ID}}"
MICROSOFT_CLIENT_SECRET = "${{MICROSOFT_CLIENT_SECRET}}"
